<!DOCTYPE html>
<html>
  <head>
  <title>
      
          Shell Scripting - Bin Zhang
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Bin Zhang" />
  <link rel="shortcut icon" type="image/x-icon" href="https://binzhang-u5f6c.github.io/img/favicon.png">

  
  
  
  
  
  <link rel="stylesheet" href="https://binzhang-u5f6c.github.io/style.min.39acacc5d2051426f655a6b7fbf4786fbd0fd8fffd09322c9b497ef0f7439b3f.css" integrity="sha256-OaysxdIFFCb2Vaa3&#43;/R4b70P2P/9CTIsm0l&#43;8PdDmz8=">
  
  
  
  <link rel="stylesheet" href="https://binzhang-u5f6c.github.io/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css" media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB&#43;BLd7VPoFFdCmg9OezbJR26lg/h&#43;Wb3/zb8I=">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  
  
  <link rel="stylesheet" href="https://binzhang-u5f6c.github.io/css/custom.css">
  

  <meta property="og:title" content="Shell Scripting" />
<meta property="og:description" content="1. Basic scripting building 1.1 Display messages Use echo to display messages.
echo &#34;Hello world!&#34; 1.2 Use variables Define and reference a variable.
val=10 echo ${val} In most cases, the curly brackets can be ignored.
val=str # ignore curly brackets echo $val # ignoring curly brackets will lead to error echo ${val}ing Define and reference an array.
a[0]=1 echo ${a[0]} # or a = (1 2 3) echo ${a[0]} Note: bash treats all values as string." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://binzhang-u5f6c.github.io/posts/shell-scripting/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-06T21:33:42+08:00" />
<meta property="article:modified_time" content="2020-08-06T21:33:42+08:00" />

<meta itemprop="name" content="Shell Scripting">
<meta itemprop="description" content="1. Basic scripting building 1.1 Display messages Use echo to display messages.
echo &#34;Hello world!&#34; 1.2 Use variables Define and reference a variable.
val=10 echo ${val} In most cases, the curly brackets can be ignored.
val=str # ignore curly brackets echo $val # ignoring curly brackets will lead to error echo ${val}ing Define and reference an array.
a[0]=1 echo ${a[0]} # or a = (1 2 3) echo ${a[0]} Note: bash treats all values as string."><meta itemprop="datePublished" content="2020-08-06T21:33:42+08:00" />
<meta itemprop="dateModified" content="2020-08-06T21:33:42+08:00" />
<meta itemprop="wordCount" content="1330">
<meta itemprop="keywords" content="others," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:image" content="https://binzhang-u5f6c.github.io/img/avatar.jpg"/>
<meta name="twitter:title" content="Shell Scripting"/>
<meta name="twitter:description" content="1. Basic scripting building 1.1 Display messages Use echo to display messages.
echo &#34;Hello world!&#34; 1.2 Use variables Define and reference a variable.
val=10 echo ${val} In most cases, the curly brackets can be ignored.
val=str # ignore curly brackets echo $val # ignoring curly brackets will lead to error echo ${val}ing Define and reference an array.
a[0]=1 echo ${a[0]} # or a = (1 2 3) echo ${a[0]} Note: bash treats all values as string."/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  
  
</head>

  <body>
    
  <h1>Shell Scripting</h1>
  <header>
  
  <div class="avatar">
    <img class="avatarMask" src="https://binzhang-u5f6c.github.io/img/avatar.jpg" alt="">
    <a href="https://binzhang-u5f6c.github.io"><img class="avatar-border" src="https://binzhang-u5f6c.github.io/img/avatar-border.svg" alt=""></a>
  </div>
  
  <h2><a class="author" href="https://binzhang-u5f6c.github.io">Bin Zhang</a></h2>
</header>

  
  
  
  <p class="date">August 6, 2020</p>
  
  
  
  <div id="tags">
    <ul>
      
        
        
          <li><a href="https://binzhang-u5f6c.github.io/tags/others/">others</a></li>
        
      
    </ul>
  </div>
  
  
  <div id="contentBody">
    <h2 id="1-basic-scripting-building">1. Basic scripting building</h2>
<h3 id="11-display-messages">1.1 Display messages</h3>
<p>Use <code>echo</code> to display messages.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo <span style="color:#e6db74">&#34;Hello world!&#34;</span>
</code></pre></div><h3 id="12-use-variables">1.2 Use variables</h3>
<p>Define and reference a variable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">val<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
echo <span style="color:#e6db74">${</span>val<span style="color:#e6db74">}</span>
</code></pre></div><p>In most cases, the curly brackets can be ignored.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">val<span style="color:#f92672">=</span>str
<span style="color:#75715e"># ignore curly brackets</span>
echo $val
<span style="color:#75715e"># ignoring curly brackets will lead to error</span>
echo <span style="color:#e6db74">${</span>val<span style="color:#e6db74">}</span>ing
</code></pre></div><p>Define and reference an array.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">a<span style="color:#f92672">[</span>0<span style="color:#f92672">]=</span><span style="color:#ae81ff">1</span>
echo <span style="color:#e6db74">${</span>a[0]<span style="color:#e6db74">}</span>
<span style="color:#75715e"># or</span>
a <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> 3<span style="color:#f92672">)</span>
echo <span style="color:#e6db74">${</span>a[0]<span style="color:#e6db74">}</span>
</code></pre></div><p><strong>Note</strong>: bash treats all values as string.</p>
<h3 id="13-exit">1.3 Exit</h3>
<p>Use <code>echo $?</code> to check the exit status.
Use <code>exit N</code> to return the status <code>N</code>.</p>
<h2 id="2-conditional-statements">2. Conditional statements</h2>
<h3 id="21-if-then-statements">2.1 if-then statements</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">if</span> command; <span style="color:#66d9ef">then</span>
    commands
<span style="color:#66d9ef">elif</span> command; <span style="color:#66d9ef">then</span>
    commands
<span style="color:#66d9ef">else</span>
    commands
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>The commands under the <code>then</code> statement will be executed
only if the command after <code>if</code> statement is a valid command
and the exit status is zero.</p>
<h3 id="22-testing-conditions">2.2 Testing conditions</h3>
<p>Besides commands, bash provides a way to test conditions.
There are three types of conditions:</p>
<ul>
<li>numeric comparisons</li>
<li>string comparisons</li>
<li>file comparisons</li>
</ul>
<p>Use double parentheses for numeric comparisons,
including most operators in C and <code>**</code> for exponentiation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span> expression <span style="color:#f92672">))</span>; <span style="color:#66d9ef">then</span>
    commands
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>Use double square brackets for string comparisons,
including normal string operators and <code>=~</code> for regular expression.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> comparison <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
    commands
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>The file comparisons are the most powerful and most used comparisons in shell
scripting.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> condition <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    commands
<span style="color:#66d9ef">fi</span>
</code></pre></div><table>
<thead>
<tr>
<th>Comparison</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-e file</td>
<td>Check if file exists</td>
</tr>
<tr>
<td>-d file</td>
<td>Check if file exists and is a directory</td>
</tr>
<tr>
<td>-f file</td>
<td>Check if file exists and is a file</td>
</tr>
<tr>
<td>-r file</td>
<td>Check if file exists and is readable</td>
</tr>
<tr>
<td>-w file</td>
<td>Check if file exists and is writable</td>
</tr>
<tr>
<td>-x file</td>
<td>Check if file exists and is executable</td>
</tr>
<tr>
<td>-s file</td>
<td>Check if file exists and is not empty</td>
</tr>
<tr>
<td>-O file</td>
<td>Check if file exists and is owned by the current user</td>
</tr>
<tr>
<td>-G file</td>
<td>Check if file exists and is owned by the current group</td>
</tr>
<tr>
<td>file1 -nt file2</td>
<td>Check if file1 is newer than file2</td>
</tr>
<tr>
<td>file1 -ot file2</td>
<td>Check if file1 is older than file2</td>
</tr>
</tbody>
</table>
<p>In addition, you can combine conditions using AND (&amp;&amp;) and OR (||).</p>
<h3 id="23-case-statements">2.3 case statements</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">case</span> variable in
    pattern1<span style="color:#f92672">)</span>
        commands
        ;;
    pattern2 | pattern3<span style="color:#f92672">)</span>
        commands
        ;;
    *<span style="color:#f92672">)</span>
        commands
        ;;
<span style="color:#66d9ef">esac</span>
</code></pre></div><h2 id="3-looping-statements">3. Looping statements</h2>
<h3 id="31-for-statements">3.1 for statements</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">for</span> var in words; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span>
</code></pre></div><p>We can create words by brace expansion, wildcards or command substitution.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># brace expansion</span>
<span style="color:#66d9ef">for</span> var in <span style="color:#f92672">{</span>a..z<span style="color:#f92672">}</span>; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span>

<span style="color:#75715e"># wildcards</span>
<span style="color:#66d9ef">for</span> var in *.txt; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span>

<span style="color:#75715e"># command substitution</span>
<span style="color:#66d9ef">for</span> var in <span style="color:#66d9ef">$(</span>command<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span>
</code></pre></div><p>We can change the value of <code>IFS</code> to change separator temporarily.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">IFS.OLD<span style="color:#f92672">=</span>$IFS
IFS<span style="color:#f92672">=</span><span style="color:#e6db74">$&#39;\n&#39;</span>:;<span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">commands
</span><span style="color:#e6db74">IFS=</span>$IFS<span style="color:#e6db74">.OLD
</span></code></pre></div><p>Bash also provides the C-style <code>for</code> statements.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">for</span> <span style="color:#f92672">((</span> expression1; expression2; expression3 <span style="color:#f92672">))</span>; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span>
</code></pre></div><h3 id="32-while-and-until-statements">3.2 while and until statements</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># while</span>
<span style="color:#66d9ef">while</span> command; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span>

<span style="color:#75715e"># until</span>
<span style="color:#66d9ef">until</span> command; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span>
</code></pre></div><h3 id="33-control-the-loop">3.3 Control the loop</h3>
<p>Two commands are used to control what happens inside of a loop:</p>
<ul>
<li><code>break</code></li>
<li><code>continue</code></li>
</ul>
<p><code>break n</code> can indicate the level of the loop to break out of.
By default n is 1.</p>
<h3 id="34-process-the-output-of-a-loop">3.4 Process the output of a loop</h3>
<p>You can redirect or pipe the output of a loop within the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># redirect</span>
<span style="color:#66d9ef">for</span> var in words; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span> &gt; output.txt

<span style="color:#75715e"># pipe</span>
<span style="color:#66d9ef">for</span> var in words; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span> | grep txt
</code></pre></div><h2 id="4-handle-input">4. Handle input</h2>
<h3 id="41-command-line-parameters">4.1 Command line parameters</h3>
<ul>
<li>Use <code>$0</code> to refer to the script name.</li>
<li>Use <code>$1</code>, <code>$2</code> and so on to refer to the command line parameters.</li>
<li>If the number is larger than 9, use curly brackets <code>${n}</code>.</li>
<li><code>$#</code> contains the number of parameters.</li>
<li>Use <code>${!#}</code> to refer the last parameter.</li>
</ul>
<p>Both <code>$*</code> and <code>$@</code> include all the command line parameters.
The former takes all the parameters as a single word,
while the latter takes all the parameters as separate words.</p>
<h3 id="42-being-shifty">4.2 Being shifty</h3>
<p><code>shift</code> moves each parameter variable one position to the left by default.
For example, after <code>shift</code> command,
<code>$3</code> refers to the fourth parameter,
<code>$2</code> refers to the third parameter,
and <code>$1</code> refers to the second parameter.
Note that <code>$0</code> always refers to the script name.</p>
<p>You can use <code>shift</code> to work with options.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">while</span> <span style="color:#f92672">[</span> -n <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">do</span>
    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> in
        -a<span style="color:#f92672">)</span>
            commands
            ;;
        *<span style="color:#f92672">)</span>
            echo <span style="color:#e6db74">&#34;Error&#34;</span>
            ;;
    <span style="color:#66d9ef">esac</span>
    shift
<span style="color:#66d9ef">done</span>
</code></pre></div><p>Usually the Linux-style command looks like <code>command options parameter</code>,
and some options even requre another parameters, such as</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ls -a
rm -rf file
curl -o outputfile url
</code></pre></div><p>In such cases, <code>getopts</code> is a better choice rather than <code>shift</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">getopts optstring opt
</code></pre></div><p>The <code>optstring</code> lists all valid option characters.
A colon after a character means the option requires a value.
Each time it is invoked, an option is assigned in <code>opt</code>,
and the index of next option is assigned in <code>OPTIND</code>.
If the option requres a value, it will be stored in <code>OPTARG</code>.
Thus <code>OPTIND</code> should be initialized as 1 at first.
Here is an example.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">OPTIND<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">while</span> getopts a:bc opt; <span style="color:#66d9ef">do</span>
    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;</span>$opt<span style="color:#e6db74">&#34;</span> in
        a<span style="color:#f92672">)</span>
            <span style="color:#75715e"># store value in val</span>
            val<span style="color:#f92672">=</span>$OPTARG
            commands
            ;;
        b<span style="color:#f92672">)</span>
            commands
            ;;
        c<span style="color:#f92672">)</span>
            commands
        *<span style="color:#f92672">)</span>
            echo <span style="color:#e6db74">&#34;Error&#34;</span>
            ;;
    <span style="color:#66d9ef">esac</span>
<span style="color:#66d9ef">done</span>

shift <span style="color:#66d9ef">$((</span>$OPTIND<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#66d9ef">))</span>
<span style="color:#66d9ef">for</span> var in <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span>
</code></pre></div><h3 id="43-get-user-input">4.3 Get user input</h3>
<p>There are two forms of <code>read</code> command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># form 1</span>
echo -n question
read var

<span style="color:#75715e"># form 2</span>
read -p question var
</code></pre></div><p>Use <code>-t</code> option to deal with timing out.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo -n question
<span style="color:#66d9ef">if</span> read -t seconds var; <span style="color:#66d9ef">then</span>
    commands
<span style="color:#66d9ef">else</span>
    echo <span style="color:#e6db74">&#34;Time out!&#34;</span>
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>Use <code>-n</code> option to limit the input size.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># accept only one character</span>
read -n1 var
</code></pre></div><p>Use <code>-s</code> option to prevent the input from displaying on the monitor.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo -n <span style="color:#e6db74">&#34;Enter your password: &#34;</span>
read -s passwd
</code></pre></div><p>Read from file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat file.txt | <span style="color:#66d9ef">while</span> read line; <span style="color:#66d9ef">do</span>
    commands
<span style="color:#66d9ef">done</span>
</code></pre></div><h2 id="5-file-descriptors">5. File descriptors</h2>
<h3 id="51-redirect-to-a-file-descriptor">5.1 Redirect to a file descriptor</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">command &gt;&amp;<span style="color:#ae81ff">2</span>
</code></pre></div><h3 id="52-redirect-a-file-descriptor-to-files">5.2 Redirect a file descriptor to files</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">exec 1&gt;file1
exec 0&lt;file2
</code></pre></div><h3 id="53-create-your-own-file-descriptors">5.3 Create your own file descriptors</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">exec 3&gt;file1
exec 4&lt;file2
exec 5&lt;&gt;file3
</code></pre></div><p>Save the STDIN/STDOUT file descriptor location to another file descriptor
temporarily to read/write a file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">exec 3&gt;&amp;<span style="color:#ae81ff">1</span>
exec 1&gt;file1
echo <span style="color:#e6db74">&#34;hello world&#34;</span> <span style="color:#75715e"># write to file1</span>
exec 1&gt;&amp;<span style="color:#ae81ff">3</span>
echo <span style="color:#e6db74">&#34;hello world&#34;</span> <span style="color:#75715e"># write to STDOUT</span>

exec 3&lt;&amp;<span style="color:#ae81ff">0</span>
exec 0&lt;file2
read var <span style="color:#75715e"># read from file2</span>
exec 0&lt;&amp;<span style="color:#ae81ff">3</span>
read var <span style="color:#75715e"># read from STDIN</span>
</code></pre></div><p>Close file descriptors.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">exec 3&gt;&amp;-
</code></pre></div><h2 id="6-trap-signals">6. Trap signals</h2>
<p>To trap signals in a script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">trap command signals

<span style="color:#75715e"># the trap can be modified</span>
trap command2 signals

<span style="color:#75715e"># also can be removed</span>
trap -- signals
</code></pre></div><p>To trap a script exit</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">trap commands EXIT
</code></pre></div><h2 id="7-create-functions">7. Create functions</h2>
<h3 id="71-basic-script-functions">7.1 Basic script functions</h3>
<p>There are two forms to define a function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># form 1</span>
<span style="color:#66d9ef">function</span> name <span style="color:#f92672">{</span>
    commands
<span style="color:#f92672">}</span>

<span style="color:#75715e">#form 2</span>
name<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    commands
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="72-return-a-value">7.2 Return a value</h3>
<p>The return statement is different from other programming languages.
It return the exit status of the function.
The exit status must be in the range of 0 to 255.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">function</span> func <span style="color:#f92672">{</span>
    commands
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
<span style="color:#f92672">}</span>

func
echo <span style="color:#e6db74">&#34;The exit status is </span>$?<span style="color:#e6db74">&#34;</span>
</code></pre></div><p>To return a value like other programming languages,
you can capture the output of the function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">function</span> func <span style="color:#f92672">{</span>
    commands
    echo output
<span style="color:#f92672">}</span>

output<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>func<span style="color:#66d9ef">)</span>
</code></pre></div><h3 id="73-use-variables-in-functions">7.3 Use variables in functions</h3>
<p>The bash shell treats functions just like scripts.
You can pass parameters to a function just like a regular script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">function</span> func <span style="color:#f92672">{</span>
    command
<span style="color:#f92672">}</span>

func parameters
</code></pre></div><p>Parameters can also be passed to functions via global variables.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">var<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">function</span> func <span style="color:#f92672">{</span>
    var<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
<span style="color:#f92672">}</span>

func
<span style="color:#75715e"># var=2</span>
echo <span style="color:#e6db74">&#34;var=</span>$var<span style="color:#e6db74">&#34;</span>
</code></pre></div><p>To avoid modifying the value defined outside functions,
you can use local variables.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">var<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">function</span> func <span style="color:#f92672">{</span>
    local var<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
<span style="color:#f92672">}</span>

func
<span style="color:#75715e"># var=1</span>
echo <span style="color:#e6db74">&#34;var=</span>$var<span style="color:#e6db74">&#34;</span>
</code></pre></div><h3 id="74-array-variables-and-functions">7.4 Array variables and functions</h3>
<p>Passing an array to a function is very confusing.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">function</span> func <span style="color:#f92672">{</span>
    local newarray
    newarray<span style="color:#f92672">=(</span>;<span style="color:#e6db74">&#39;echo &#34;$@&#34;&#39;</span><span style="color:#f92672">)</span>
    echo <span style="color:#e6db74">${</span>newarray[*]<span style="color:#e6db74">}</span>
<span style="color:#f92672">}</span>

myarray1<span style="color:#f92672">=(</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> 3<span style="color:#f92672">)</span>
myarray2<span style="color:#f92672">=(</span><span style="color:#66d9ef">$(</span>func $myarray1<span style="color:#66d9ef">)</span><span style="color:#f92672">)</span>
</code></pre></div><h3 id="75-function-recursion">7.5 Function recursion</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">function</span> func <span style="color:#f92672">{</span>
    commands
    var<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>func<span style="color:#66d9ef">)</span>
    commands
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="76-create-a-library">7.6 Create a library</h3>
<p>To use functions defined in other script files:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">source script_file.sh
</code></pre></div><h3 id="77-use-functions-on-the-command-line">7.7 Use functions on the command line</h3>
<p>Define functions in the <code>.bashrc</code> file,
then you can use them in the command line.</p>

  </div>
  <footer>
  <p>
  &copy;  Bin Zhang.
  Powered by <a href="https://gohugo.io/">Hugo</a>
  using the <a href="https://github.com/koirand/pulp/">pulp</a> theme.
  </p>
</footer><script src="https://binzhang-u5f6c.github.io/js/custom.js"></script>



  </body>
</html>
